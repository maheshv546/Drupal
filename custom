/**
 * Implements hook_preprocess_views_view().
 */
function mymodule_preprocess_views_view(&$variables) {
  $view = $variables['view'];

  // Check if this is the FullCalendar Legend view.
  if ($view->id() === 'fullcalendar_legend') {
    \Drupal::logger('mymodule')->notice('Preprocessing FullCalendar Legend.');

    if (!empty($variables['rows'])) {
      foreach ($variables['rows'] as $index => $row) {
        if (is_object($row) && method_exists($row, 'getTitle')) {
          // Extract the taxonomy term name safely.
          $term_name = strtolower(str_replace(' ', '-', $row->getTitle()));

          // Ensure attributes array exists before modifying.
          if (!isset($row->attributes)) {
            $row->attributes = new \Drupal\Core\Template\Attribute();
          }

          // Add custom classes based on the term.
          $row->attributes->addClass(['legend-term-' . $term_name, 'colour-palette-' . $index]);
        }
      }
    }
  }
}