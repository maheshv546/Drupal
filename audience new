<?php

namespace Drupal\Tests\my_module\Functional;

use Drupal\Tests\BrowserTestBase;

/**
 * Tests the custom Twig extension for theme image paths.
 *
 * @group my_module
 */
class MyCustomTwigTest extends BrowserTestBase {

  /**
   * {@inheritdoc}
   */
  protected static $modules = ['node', 'block', 'my_module'];

  /**
   * A user with permissions to view content.
   */
  protected $user;

  /**
   * {@inheritdoc}
   */
  protected function setUp(): void {
    parent::setUp();

    // Create and log in a user.
    $this->user = $this->drupalCreateUser(['access content']);
    $this->drupalLogin($this->user);
  }

  /**
   * Tests if the Twig filter correctly generates the theme image path.
   */
  public function testTwigThemeImageFilter() {
    // Create a test page with the Twig template applied.
    $this->drupalPlaceBlock('system_main_block');

    // Visit the homepage.
    $this->drupalGet('<front>');

    // Assert that the custom Twig filter correctly generates the theme image path.
    $theme_path = '/themes/custom/' . \Drupal::service('theme_handler')->getDefault();
    $expected_image_url = $theme_path . '/assets/logo.png';

    // Check if the image URL is present in the rendered page.
    $this->assertSession()->elementExists('css', 'img[src="' . $expected_image_url . '"]');
  }

}