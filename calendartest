(function ($, Drupal) {
  Drupal.behaviors.customTooltip = {
    attach: function (context, settings) {
      // Wait for the FullCalendar to be initialized.
      $(document).once('custom-tooltip-init').on('fullCalendarRendered', function () {
        // Access the FullCalendar instance.
        var calendarEl = $('.fullcalendar', context).get(0);
        
        if (calendarEl && calendarEl.fullCalendar) {
          calendarEl.fullCalendar('option', 'eventDidMount', function (info) {
            // Add the title attribute to the event element.
            var eventTitle = info.event.title;
            if (eventTitle) {
              $(info.el).attr('title', eventTitle);

              // Apply jQuery UI tooltip (if available).
              if ($.fn.tooltip) {
                $(info.el).tooltip();
              }
            }
          });
        }
      });

      // Trigger a custom event when FullCalendar is rendered.
      $('.fullcalendar', context).once('custom-tooltip').each(function () {
        $(this).trigger('fullCalendarRendered');
      });
    }
  };
})(jQuery, Drupal);


(function ($, Drupal, once) {
  Drupal.behaviors.customTooltip = {
    attach: function (context, settings) {
      // Attach tooltips to events after FullCalendar renders.
      $('.fullcalendar', context).once('custom-tooltip').each(function () {
        $(this).on('DOMSubtreeModified', function () {
          // Find all events and add the tooltip.
          $('.fc-event', context).each(function () {
            var eventTitle = $(this).find('.fc-title').text();
            if (eventTitle && !$(this).attr('title')) {
              $(this).attr('title', eventTitle);
              // Use jQuery UI tooltip if available.
              if ($.fn.tooltip) {
                $(this).tooltip();
              }
            }
          });
        });
      });
    }
  };
})(jQuery, Drupal, once);


(function ($, Drupal, once) {
  Drupal.behaviors.customTooltip = {
    attach: function (context) {
      // Initialize tooltips on calendar events.
      function initializeTooltips() {
        $('.fc-event', context).each(function () {
          var eventTitle = $(this).find('.fc-title').text();
          if (eventTitle && !$(this).attr('title')) {
            $(this).attr('title', eventTitle);

            // Apply jQuery UI tooltip if available.
            if ($.fn.tooltip) {
              $(this).tooltip();
            }
          }
        });
      }

      // Observe changes in the FullCalendar container.
      $('.fullcalendar', context).once('custom-tooltip').each(function () {
        const targetNode = this;

        // Create a mutation observer to detect changes.
        const observer = new MutationObserver(function (mutations) {
          mutations.forEach(function (mutation) {
            if (mutation.type === 'childList') {
              initializeTooltips();
            }
          });
        });

        // Start observing the calendar for child node changes.
        observer.observe(targetNode, {
          childList: true,
          subtree: true,
        });

        // Initialize tooltips when the page first loads.
        initializeTooltips();
      });
    }
  };
})(jQuery, Drupal, once);